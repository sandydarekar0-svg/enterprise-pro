<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <span class="navbar-brand">ðŸ“Š Admin Dashboard</span>
        <a href="/logout" class="btn btn-danger btn-sm">Logout</a>
    </div>
</nav>

<div class="container-fluid p-4">
    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center bg-primary text-white">
                <div class="card-body">
                    <h5>Total Users</h5>
                    <h2 id="totalUsers">--</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center bg-success text-white">
                <div class="card-body">
                    <h5>Total Messages</h5>
                    <h2 id="totalMessages">--</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center bg-info text-white">
                <div class="card-body">
                    <h5>Total Campaigns</h5>
                    <h2 id="totalCampaigns">--</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center bg-warning text-white">
                <div class="card-body">
                    <h5>Total Revenue</h5>
                    <h2 id="totalRevenue">--</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Users Table -->
    <div class="card">
        <div class="card-header">
            <h5>All Users</h5>
        </div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Credits</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="usersList"></tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="../assets/js/api.js"></script>
<script>
    // Load stats
    fetch('/api/admin.php?action=stats')
        .then(r => r.json())
        .then(d => {
            if (d.success) {
                document.getElementById('totalUsers').textContent = d.data.total_users;
                document.getElementById('totalMessages').textContent = d.data.total_messages;
                document.getElementById('totalCampaigns').textContent = d.data.total_campaigns;
                document.getElementById('totalRevenue').textContent = '$' + (d.data.total_revenue || 0);
            }
        });

    // Load users
    fetch('/api/admin.php?action=users')
        .then(r => r.json())
        .then(d => {
            if (d.success) {
                const html = d.data.map(u => `
                    <tr>
                        <td>${u.username}</td>
                        <td>${u.email}</td>
                        <td><span class="badge bg-primary">${u.role}</span></td>
                        <td>${u.credits}</td>
                        <td><span class="badge bg-success">${u.status}</span></td>
                        <td>
                            <button class="btn btn-sm btn-success" onclick="addCredits(${u.id})">Add Credits</button>
                        </td>
                    </tr>
                `).join('');
                document.getElementById('usersList').innerHTML = html;
            }
        });

    function addCredits(userId) {
        const credits = prompt('Add how many credits?');
        if (credits) {
            const formData = new FormData();
            formData.append('action', 'add_credits');
            formData.append('user_id', userId);
            formData.append('credits', credits);
            
            fetch('/api/admin.php', {
                method: 'POST',
                body: formData
            })
            .then(r => r.json())
            .then(d => {
                alert(d.message);
                location.reload();
            });
        }
    }
</script>

</body>
</html>
